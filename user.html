<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User - Wise-Vent</title>
    <link rel="stylesheet" href="Pages.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-calendar-alt"></i> Wise-Vent
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item"><a href="Dash.html#home" class="nav-link">Dashboard</a></li>
                <li class="nav-item"><a href="user.html" class="nav-link">User</a></li>
                <li class="nav-item nav-profile">
                    <a href="logout.html" class="profile-btn">
                        <i class="fas fa-sign-out-alt"></i> Log Out
                    </a>
                </li>
            </ul>
            <div class="hamburger" id="hamburger">
                <span></span><span></span><span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="hero-section-user">
        <div class="container">
            <div class="back-btn-wrapper">
                <a href="Dash.html" class="back-btn" title="Back to Dashboard">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="page-header">
                <div>
                    <h1><i class="fas fa-user"></i> User</h1>
                    <p>Manage your profile, settings, and account</p>
                </div>
            </div>
        </div>
    </section>

    <main class="content-wrapper">
        <div class="container">

            <!-- Tabs Navigation -->
            <div class="account-tabs">
                <button class="tab-button active" onclick="switchTab('profile')">
                    <i class="fas fa-user-circle"></i> Profile
                </button>
                <button class="tab-button" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content active">
                <div class="profile-container">
                    <!-- Profile Picture Section -->
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-picture">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="profile-info">
                                <h2>John Doe</h2>
                                <p>john.doe@example.com</p>
                                <p class="member-since">Member since March 2024</p>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Details Section -->
                    <div class="profile-card">
                        <h3><i class="fas fa-user-edit"></i> Personal Information</h3>
                        <form class="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" value="John" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" value="Doe" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" value="john.doe@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" value="+1 (555) 123-4567" placeholder="+1 (555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label for="bio">Bio</label>
                                <textarea id="bio" placeholder="Tell us about yourself..." rows="4">Event enthusiast and community organizer.</textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" value="San Francisco" placeholder="City">
                                </div>
                                <div class="form-group">
                                    <label for="state">State/Province</label>
                                    <input type="text" id="state" value="California" placeholder="State">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Account Statistics -->
                    <div class="profile-stats">
                        <div class="stat-card">
                            <i class="fas fa-calendar-check"></i>
                            <div>
                                <p class="stat-number">12</p>
                                <p class="stat-label">Events Attended</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-plus"></i>
                            <div>
                                <p class="stat-number">3</p>
                                <p class="stat-label">Events Created</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-heart"></i>
                            <div>
                                <p class="stat-number">8</p>
                                <p class="stat-label">Wishlist Events</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="settings-container">
                    <!-- Account Settings -->
                    <div class="settings-card">
                        <h3><i class="fas fa-lock"></i> Account Security</h3>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Password</p>
                                <p class="settings-description">Change your password regularly to keep your account secure</p>
                            </div>
                            <button class="btn btn-small">Change Password</button>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Two-Factor Authentication</p>
                                <p class="settings-description">Add an extra layer of security to your account</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Email Notifications</p>
                                <p class="settings-description">Receive updates about events and activities</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Event Reminders</p>
                                <p class="settings-description">Get reminded before events start</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Marketing Emails</p>
                                <p class="settings-description">Receive promotional offers and announcements</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="settings-card">
                        <h3><i class="fas fa-eye-slash"></i> Privacy</h3>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Profile Visibility</p>
                                <p class="settings-description">Choose who can see your profile</p>
                            </div>
                            <select class="settings-select">
                                <option value="public">Public</option>
                                <option value="private">Private</option>
                                <option value="friends">Friends Only</option>
                            </select>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Search Visibility</p>
                                <p class="settings-description">Allow your profile to appear in search results</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Preference Settings -->
                    <div class="settings-card">
                        <h3><i class="fas fa-palette"></i> Preferences</h3>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Theme</p>
                                <p class="settings-description">Choose your preferred theme</p>
                            </div>
                            <select class="settings-select">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        <div class="settings-divider"></div>
                        <div class="settings-item">
                            <div class="settings-info">
                                <p class="settings-title">Language</p>
                                <p class="settings-description">Select your preferred language</p>
                            </div>
                            <select class="settings-select">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="alert('Settings saved!')">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Wise-vent</h4>
                    <p>Your ultimate event management platform</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="Dash.html#home">Dashboard</a></li>
                        <li><a href="myevents.html">My Events</a></li>
                        <li><a href="user.html">User</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Follow Us</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <hr>
            <p class="footer-bottom">&copy; 2026 Wise-Vent. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab and activate button
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
    </script>
    <script type="module" src="authGuard.js"></script>
    <script type="module">
        import { supabase } from './supabaseClient.js';

        async function getProfileStorageKey() {
            const { data } = await supabase.auth.getSession();
            const userId = data?.session?.user?.id || 'anonymous';
            return `profile:${userId}`;
        }

        function updateHeaderFromProfile(profile, user) {
            const nameHeading = document.querySelector('.profile-info h2');
            const emailPara = document.querySelector('.profile-info p:nth-of-type(1)');
            const memberSincePara = document.querySelector('.profile-info .member-since');

            if (nameHeading) {
                nameHeading.textContent = `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || (user?.email ?? 'User');
            }
            if (emailPara && user?.email) {
                emailPara.textContent = user.email;
            }
            if (memberSincePara && user?.created_at) {
                const joined = new Date(user.created_at);
                memberSincePara.textContent = `Member since ${joined.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                })}`;
            }
        }

        async function loadProfile() {
            const { data } = await supabase.auth.getSession();
            const user = data?.session?.user;

            const storageKey = await getProfileStorageKey();
            const saved = JSON.parse(localStorage.getItem(storageKey) || '{}');

            // Default values from Supabase user
            const meta = user?.user_metadata || {};
            const defaultFirstName = meta.firstName || meta.given_name || '';
            const defaultLastName = meta.lastName || meta.family_name || '';

            const profile = {
                firstName: saved.firstName ?? defaultFirstName,
                lastName: saved.lastName ?? defaultLastName,
                email: user?.email || saved.email || '',
                phone: saved.phone ?? '',
                bio: saved.bio ?? '',
                city: saved.city ?? '',
                state: saved.state ?? '',
            };

            // Fill form fields
            (document.getElementById('firstName') || {}).value = profile.firstName;
            (document.getElementById('lastName') || {}).value = profile.lastName;
            (document.getElementById('email') || {}).value = profile.email;
            (document.getElementById('phone') || {}).value = profile.phone;
            (document.getElementById('bio') || {}).value = profile.bio;
            (document.getElementById('city') || {}).value = profile.city;
            (document.getElementById('state') || {}).value = profile.state;

            updateHeaderFromProfile(profile, user);
        }

        async function handleProfileSubmit(event) {
            event.preventDefault();

            const profile = {
                firstName: (document.getElementById('firstName') || {}).value?.trim() || '',
                lastName: (document.getElementById('lastName') || {}).value?.trim() || '',
                email: (document.getElementById('email') || {}).value?.trim() || '',
                phone: (document.getElementById('phone') || {}).value?.trim() || '',
                bio: (document.getElementById('bio') || {}).value?.trim() || '',
                city: (document.getElementById('city') || {}).value?.trim() || '',
                state: (document.getElementById('state') || {}).value?.trim() || '',
            };

            const storageKey = await getProfileStorageKey();
            localStorage.setItem(storageKey, JSON.stringify(profile));

            try {
                // Also try to update Supabase user metadata so profile follows the user
                await supabase.auth.updateUser({
                    data: {
                        firstName: profile.firstName,
                        lastName: profile.lastName,
                        phone: profile.phone,
                        bio: profile.bio,
                        city: profile.city,
                        state: profile.state,
                    },
                });
            } catch (err) {
                console.error('Error updating Supabase user metadata:', err);
            }

            const { data } = await supabase.auth.getSession();
            const user = data?.session?.user;
            updateHeaderFromProfile(profile, user);

            alert('Profile saved successfully.');
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadProfile();
            const profileForm = document.querySelector('.profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileSubmit);
            }
        });
    </script>
</body>
</html>
